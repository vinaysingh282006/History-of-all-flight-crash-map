<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Redirecting to Full Stack Web Development - FreeSkillz</title>
    <meta http-equiv="refresh" content="0; url=course.html?course=webdev">
</head>
<body>


    <!-- Login Modal -->
    <div id="login-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <span class="close" onclick="closeLoginModal()">&times;</span>
            <h2>Log In</h2>
            <p>Enter your name to continue:</p>
            <input type="text" id="user-name-input" placeholder="Your Name" class="login-input">
            <button class="btn btn-primary" onclick="loginUser()">Log In</button>
        </div>
    </div>

    <!-- Course Header -->
    <section class="course-header">
        <div class="course-header-container">
            <div class="premium-badge">Most Popular</div>
            <h1 id="course-title">Full Stack Web Development</h1>
            <button id="enroll-btn" class="btn btn-secondary" onclick="enrollInCourse('webdev')">Enroll in Course</button>
        </div>
    </section>

    <!-- Course Content Section -->
    <section class="course-content-section">
        <div class="container">
            <div class="course-layout">
                <!-- Player Section (Left) -->
                <div class="player-section">
                    <div class="player-container">
                        <!-- Course Title at the top of player -->
                        <h2 id="player-course-title" class="course-title-header">Full Stack Web Development</h2>
                        
                        <div id="player-placeholder" class="player-placeholder">
                            <div class="player-placeholder-content">
                                <h3>Select a lesson to begin</h3>
                                <p>Please choose a lesson from the list on the right to start learning</p>
                                <div class="player-placeholder-icon">‚ñ∂Ô∏è</div>
                            </div>
                        </div>
                        <iframe id="lesson-player" class="lesson-player" frameborder="0" 
                            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
                            allowfullscreen></iframe>
                        <div id="document-viewer" class="document-viewer" style="display: none;">
                            <h3 id="document-title">Document Lesson</h3>
                            <p>This is a document lesson. Please click the button below to access the document:</p>
                            <a id="document-link" href="#" target="_blank" class="btn btn-primary">View Document</a>
                        </div>
                    </div>
                    
                    <!-- Lesson Progress Tracker -->
                    <div class="lesson-progress">
                        <div class="progress-info">
                            <span id="current-lesson">No lesson selected</span>
                            <span id="lesson-counter">0/0 lessons completed</span>
                        </div>
                        <div class="progress-bar">
                            <div id="progress-fill" class="progress-fill"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Lessons List (Right) -->
                <div class="lessons-section">
                    <div class="lessons-header">
                        <h2>Course Lessons</h2>
                        <div class="course-stats">
                            <span id="completed-count">0</span> of <span id="total-count">0</span> lessons completed
                        </div>
                    </div>
                    <div id="lessons-list" class="lessons-list-sidebar">
                        <!-- Lessons will be loaded dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-content">
                <div class="footer-logo">
                    <h2>FreeSkillz</h2>
                    <p>Learn premium skills for free with our expert-curated courses and resources.</p>
                </div>
                <div class="footer-links">
                    <div class="footer-column">
                        <h4>Navigation</h4>
                        <ul>
                            <li><a href="index.html#home">Home</a></li>
                            <li><a href="index.html#explore">Explore</a></li>
                            <li><a href="index.html#features">Features</a></li>
                            <li><a href="index.html#reviews">Reviews</a></li>
                            <li><a href="index.html#contact">Contact</a></li>
                        </ul>
                    </div>
                    <div class="footer-column">
                        <h4>Legal</h4>
                        <ul>
                            <li><a href="#">Terms of Service</a></li>
                            <li><a href="#">Privacy Policy</a></li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; FreeSkillz 2025. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- Profile Button -->
    <div class="profile-button" onclick="window.location.href='profile.html'">
        <span>üë§</span>
    </div>

    <script src="assets/js/data.js"></script>
    <script src="assets/js/app.js"></script>
    <script>
        // Load course details when page loads
        document.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus(); // Check login status first
            loadCourseDetails();
        });
        
        // Load course details
        function loadCourseDetails(courseId) {
            // Fetch course data from JSON file
            fetch(`courses/${courseId}.json`)
                .then(response => response.json())
                .then(courseData => {
                    // Update course title in player
                    document.getElementById('player-course-title').textContent = courseData.title;
                    
                    // Load topics and lessons
                    const lessonsList = document.getElementById('lessons-list');
                    lessonsList.innerHTML = '';
                    
                    // Get completed lessons from localStorage
                    const completedLessons = JSON.parse(localStorage.getItem(`completedLessons_${courseId}`) || '[]');
                    
                    // Calculate total lessons
                    let totalLessons = 0;
                    if (courseData.topics) {
                        courseData.topics.forEach(topic => {
                            totalLessons += topic.lessons.length;
                        });
                    } else {
                        totalLessons = courseData.lessons ? courseData.lessons.length : 0;
                    }
                    
                    // Update total lesson count
                    document.getElementById('total-count').textContent = totalLessons;
                    
                    // Update completed count
                    document.getElementById('completed-count').textContent = completedLessons.length;
                    
                    // Update progress bar
                    updateProgress(totalLessons, completedLessons.length);
                    
                    // Check if course data has topics structure or flat lessons
                    if (courseData.topics) {
                        // Create a flat list of all lessons with their topic info
                        let allLessons = [];
                        courseData.topics.forEach((topic, topicIndex) => {
                            topic.lessons.forEach((lesson, lessonIndex) => {
                                allLessons.push({
                                    ...lesson,
                                    topicTitle: topic.title,
                                    topicIndex: topicIndex,
                                    lessonIndex: lessonIndex,
                                    globalIndex: allLessons.length
                                });
                            });
                        });
                        
                        // Add topics and lessons to the UI
                        courseData.topics.forEach((topic, topicIndex) => {
                            // Create topic header
                            const topicElement = document.createElement('div');
                            topicElement.className = 'topic-header';
                            topicElement.innerHTML = `
                                <h3 class="topic-title">${topic.title}</h3>
                            `;
                            lessonsList.appendChild(topicElement);
                            
                            // Add lessons for this topic
                            topic.lessons.forEach((lesson, lessonIndex) => {
                                const globalIndex = allLessons.findIndex(l => 
                                    l.topicIndex === topicIndex && l.lessonIndex === lessonIndex);
                                
                                const lessonElement = document.createElement('div');
                                lessonElement.className = 'lesson-item';
                                lessonElement.setAttribute('data-lesson-index', globalIndex);
                                
                                // Check if lesson is completed
                                const isCompleted = completedLessons.includes(globalIndex);
                                const completedClass = isCompleted ? 'completed' : '';
                                const completedText = isCompleted ? 'Completed' : 'Mark as Done';
                                
                                lessonElement.innerHTML = `
                                    <div class="lesson-info ${completedClass}">
                                        <div class="lesson-index">${lessonIndex + 1}</div>
                                        <div class="lesson-details">
                                            <div class="lesson-title">${lesson.title}</div>
                                            <div class="lesson-type">${lesson.type === 'video' ? 'Video Lesson' : 'Document Lesson'}</div>
                                        </div>
                                    </div>
                                    <button class="btn-mark ${isCompleted ? 'completed' : ''}" onclick="markLessonAsDone('${courseId}', ${globalIndex}, this)">
                                        ${completedText}
                                    </button>
                                `;
                                
                                // Add click event to load lesson
                                lessonElement.addEventListener('click', function(e) {
                                    if (!e.target.classList.contains('btn-mark')) {
                                        loadLesson(lesson, globalIndex, totalLessons);
                                    }
                                });
                                
                                lessonsList.appendChild(lessonElement);
                            });
                        });
                    } else {
                        // Fallback to original flat lessons structure
                        courseData.lessons.forEach((lesson, index) => {
                            const lessonElement = document.createElement('div');
                            lessonElement.className = 'lesson-item';
                            lessonElement.setAttribute('data-lesson-index', index);
                            
                            // Check if lesson is completed
                            const isCompleted = completedLessons.includes(index);
                            const completedClass = isCompleted ? 'completed' : '';
                            const completedText = isCompleted ? 'Completed' : 'Mark as Done';
                            
                            lessonElement.innerHTML = `
                                <div class="lesson-info ${completedClass}">
                                    <div class="lesson-index">${index + 1}</div>
                                    <div class="lesson-details">
                                        <div class="lesson-title">${lesson.title}</div>
                                        <div class="lesson-type">${lesson.type === 'video' ? 'Video Lesson' : 'Document Lesson'}</div>
                                    </div>
                                </div>
                                <button class="btn-mark ${isCompleted ? 'completed' : ''}" onclick="markLessonAsDone('${courseId}', ${index}, this)">
                                    ${completedText}
                                </button>
                            `;
                            
                            // Add click event to load lesson
                            lessonElement.addEventListener('click', function(e) {
                                if (!e.target.classList.contains('btn-mark')) {
                                    loadLesson(lesson, index, totalLessons);
                                }
                            });
                            
                            lessonsList.appendChild(lessonElement);
                        });
                    }
                })
                .catch(error => {
                    console.error('Error loading course data:', error);
                    // Fallback to hardcoded data for web development course
                    const courseData = {
                        "id": "webdev",
                        "title": "Full Stack Web Development",
                        "topics": [
                            {
                              "title": "Frontend Fundamentals",
                              "lessons": [
                                { "title": "HTML Basics", "type": "video", "url": "https://www.youtube.com/embed/hQVTIJBZook" },
                                { "title": "CSS Layouts", "type": "doc", "url": "https://docs.google.com/document/d/1uWDPhFdwGxJioi5DkEGRQpXyJUQqvjZF/edit" },
                                { "title": "JavaScript Fundamentals", "type": "video", "url": "https://www.youtube.com/embed/W6NZfCO5SIk" }
                              ]
                            },
                            {
                              "title": "Interactive Web Development",
                              "lessons": [
                                { "title": "DOM Manipulation", "type": "doc", "url": "https://docs.google.com/document/d/1W9VPUi5aN0_gb1NfjBbYlhkNMiuziO2_/edit" },
                                { "title": "Event Handling", "type": "video", "url": "https://www.youtube.com/embed/example1" }
                              ]
                            },
                            {
                              "title": "Backend Development",
                              "lessons": [
                                { "title": "Backend with Node.js", "type": "video", "url": "https://www.youtube.com/embed/TlB_eWDSMt4" },
                                { "title": "Database Integration", "type": "doc", "url": "https://docs.google.com/document/d/1example2/edit" }
                              ]
                            }
                        ]
                    };
                    
                    // Update course title in player
                    document.getElementById('player-course-title').textContent = courseData.title;
                    
                    // Load topics and lessons
                    const lessonsList = document.getElementById('lessons-list');
                    lessonsList.innerHTML = '';
                    
                    // Get completed lessons from localStorage
                    const completedLessons = JSON.parse(localStorage.getItem(`completedLessons_${courseId}`) || '[]');
                    
                    // Calculate total lessons
                    let totalLessons = 0;
                    if (courseData.topics) {
                        courseData.topics.forEach(topic => {
                            totalLessons += topic.lessons.length;
                        });
                    } else {
                        totalLessons = courseData.lessons ? courseData.lessons.length : 0;
                    }
                    
                    // Update total lesson count
                    document.getElementById('total-count').textContent = totalLessons;
                    
                    // Update completed count
                    document.getElementById('completed-count').textContent = completedLessons.length;
                    
                    // Update progress bar
                    updateProgress(totalLessons, completedLessons.length);
                    
                    // Process topics structure (since we know our fallback data has topics)
                    // Create a flat list of all lessons with their topic info
                    let allLessons = [];
                    courseData.topics.forEach((topic, topicIndex) => {
                        topic.lessons.forEach((lesson, lessonIndex) => {
                            allLessons.push({
                                ...lesson,
                                topicTitle: topic.title,
                                topicIndex: topicIndex,
                                lessonIndex: lessonIndex,
                                globalIndex: allLessons.length
                            });
                        });
                    });
                    
                    // Add topics and lessons to the UI
                    courseData.topics.forEach((topic, topicIndex) => {
                        // Create topic header
                        const topicElement = document.createElement('div');
                        topicElement.className = 'topic-header';
                        topicElement.innerHTML = `
                            <h3 class="topic-title">${topic.title}</h3>
                        `;
                        lessonsList.appendChild(topicElement);
                        
                        // Add lessons for this topic
                        topic.lessons.forEach((lesson, lessonIndex) => {
                            const globalIndex = allLessons.findIndex(l => 
                                l.topicIndex === topicIndex && l.lessonIndex === lessonIndex);
                            
                            const lessonElement = document.createElement('div');
                            lessonElement.className = 'lesson-item';
                            lessonElement.setAttribute('data-lesson-index', globalIndex);
                            
                            // Check if lesson is completed
                            const isCompleted = completedLessons.includes(globalIndex);
                            const completedClass = isCompleted ? 'completed' : '';
                            const completedText = isCompleted ? 'Completed' : 'Mark as Done';
                            
                            lessonElement.innerHTML = `
                                <div class="lesson-info ${completedClass}">
                                    <div class="lesson-index">${lessonIndex + 1}</div>
                                    <div class="lesson-details">
                                        <div class="lesson-title">${lesson.title}</div>
                                        <div class="lesson-type">${lesson.type === 'video' ? 'Video Lesson' : 'Document Lesson'}</div>
                                    </div>
                                </div>
                                <button class="btn-mark ${isCompleted ? 'completed' : ''}" onclick="markLessonAsDone('${courseId}', ${globalIndex}, this)">
                                    ${completedText}
                                </button>
                            `;
                            
                            // Add click event to load lesson
                            lessonElement.addEventListener('click', function(e) {
                                if (!e.target.classList.contains('btn-mark')) {
                                    loadLesson(lesson, globalIndex, totalLessons);
                                }
                            });
                            
                            lessonsList.appendChild(lessonElement);
                        });
                    });
                });
        }
        
        // Load lesson in player
        function loadLesson(lesson, index, totalLessons) {
            const playerPlaceholder = document.getElementById('player-placeholder');
            const lessonPlayer = document.getElementById('lesson-player');
            const documentViewer = document.getElementById('document-viewer');
            const documentLink = document.getElementById('document-link');
            const documentTitle = document.getElementById('document-title');
            
            // Update current lesson info with topic if available
            const topicInfo = lesson.topicTitle ? `Topic: ${lesson.topicTitle} | ` : '';
            document.getElementById('current-lesson').textContent = `${topicInfo}Lesson: ${lesson.title}`;
            
            if (lesson.type === 'video') {
                playerPlaceholder.style.display = 'none';
                documentViewer.style.display = 'none';
                lessonPlayer.style.display = 'block';
                lessonPlayer.src = lesson.url;
            } else {
                playerPlaceholder.style.display = 'none';
                lessonPlayer.style.display = 'none';
                documentViewer.style.display = 'block';
                documentTitle.textContent = lesson.title;
                documentLink.href = lesson.url;
            }
            
            // Highlight selected lesson
            document.querySelectorAll('.lesson-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`.lesson-item[data-lesson-index="${index}"]`).classList.add('active');
            
            // Update lesson counter
            document.getElementById('lesson-counter').textContent = `${index + 1}/${totalLessons} lessons`;
        }
        
        // Mark lesson as done
        function markLessonAsDone(courseId, lessonIndex, button) {
            // Get completed lessons from localStorage
            let completedLessons = JSON.parse(localStorage.getItem(`completedLessons_${courseId}`) || '[]');
            
            // Check if lesson is already completed
            const isCompleted = completedLessons.includes(lessonIndex);
            
            if (isCompleted) {
                // Remove from completed lessons
                completedLessons = completedLessons.filter(index => index !== lessonIndex);
                button.textContent = 'Mark as Done';
                button.classList.remove('completed');
                
                // Update lesson info
                button.parentElement.querySelector('.lesson-info').classList.remove('completed');
            } else {
                // Add to completed lessons
                completedLessons.push(lessonIndex);
                button.textContent = 'Completed';
                button.classList.add('completed');
                
                // Update lesson info
                button.parentElement.querySelector('.lesson-info').classList.add('completed');
            }
            
            // Save to localStorage
            localStorage.setItem(`completedLessons_${courseId}`, JSON.stringify(completedLessons));
            
            // Update UI elements
            document.getElementById('completed-count').textContent = completedLessons.length;
            updateProgress(document.querySelectorAll('.lesson-item').length, completedLessons.length);
        }
        
        // Update progress bar
        function updateProgress(totalLessons, completedLessons) {
            const progressPercentage = totalLessons > 0 ? (completedLessons / totalLessons) * 100 : 0;
            document.getElementById('progress-fill').style.width = `${progressPercentage}%`;
        }
        
        // Enroll in a course
        function enrollInCourse(courseId) {
            // Check if user has already provided their name
            let userName = localStorage.getItem('userName');
            
            if (!userName) {
                userName = prompt('Please enter your name to enroll in this course:');
                if (!userName) return;
                localStorage.setItem('userName', userName);
            }
            
            // Get current enrollments
            let enrollments = JSON.parse(localStorage.getItem('enrollments') || '[]');
            
            // Add course to enrollments if not already enrolled
            if (!enrollments.includes(courseId)) {
                enrollments.push(courseId);
                localStorage.setItem('enrollments', JSON.stringify(enrollments));
                alert(`Successfully enrolled in the course! Welcome, ${userName}!`);
            } else {
                alert(`You are already enrolled in this course, ${userName}!`);
            }
        }
    </script>
</body>
</html>